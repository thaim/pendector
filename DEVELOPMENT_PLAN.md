# Pendector 開発計画

## プロジェクト概要
ローカルリポジトリの変更を検出・管理するRust製CLIツール

## 現在の状態 (2025-08-03)
- ✅ Phase 1 完了: 基盤構築
- ✅ Phase 2 完了: Git統合
- ✅ Phase 3 完了: CLI機能拡張
- 🔄 Phase 4 進行中: 高度な機能 (リモート同期機能完了)

## コア機能

### 1. リポジトリ検出
- ローカルの.gitディレクトリを再帰的に検索
- 設定可能なベースディレクトリ

### 2. 変更状態チェック
- `git status`で未コミット変更を検出
- ブランチ状態確認
- リモートとの同期状態（pull/push必要性の検出）
- 自動fetch機能による最新状態取得

### 3. 結果表示
- 変更のあるリポジトリ一覧
- 詳細情報（ファイル数、ブランチ名、リモート同期状態）
- カラー出力対応
- JSON出力フォーマット対応
- リモート同期状態の視覚的インジケーター（↑↓矢印）

### 4. フィルタリング
- 変更のあるリポジトリのみ表示（--changes-only）
- 深度制限による検索範囲制御
- 複数パス指定による柔軟な検索

## アーキテクチャ

```
src/
├── main.rs          # CLI エントリーポイント
├── lib.rs           # ライブラリルート
├── cli/
│   └── mod.rs       # CLI コマンド定義
├── core/
│   ├── mod.rs       # コアロジック
│   ├── repo.rs      # リポジトリ構造体・操作
│   └── scanner.rs   # ディレクトリスキャン
├── git/
│   ├── mod.rs       # Git操作
│   └── status.rs    # ステータス取得
└── output/
    ├── mod.rs       # 出力フォーマット
    └── formatter.rs # 結果の整形・表示
```

## 必要な依存関係
- `walkdir`: ディレクトリ再帰探索
- `git2`: Git操作
- `colored`: カラー出力
- `serde`: 設定ファイル対応

## 実装フェーズ

### Phase 1: 基盤構築 ✅ 完了
1. ✅ 依存関係追加 (walkdir, git2, colored, serde)
2. ✅ モジュール構造作成 (cli/, core/, git/, output/)
3. ✅ 基本的なRepository構造体定義
4. ✅ ディレクトリスキャン機能 (深度制限付き)
5. ✅ 統合テスト作成 (7テスト)

### Phase 2: Git統合 ✅ 完了
1. ✅ git statusコマンド実行 (git2使用)
2. ✅ 変更検出ロジック
3. ✅ ブランチ情報取得
4. ✅ 基本的な出力機能
5. ✅ 単体テスト追加 (24テスト)

### Phase 3: CLI機能拡張 ✅ 完了
1. ✅ コマンドラインオプション追加 (paths, changes-only, verbose, max-depth, format, fetch)
2. ✅ フィルタリング機能 (changes-only)
3. ✅ カラー出力対応
4. ✅ 詳細表示モード (verbose)
5. ✅ JSON出力フォーマット対応
6. ✅ 自動fetch機能

### Phase 4: 高度な機能 ✅ 完了
1. ✅ リモート同期状態検出 (needs_pull/needs_push)
2. ✅ 自動fetch機能と非対話的実行
3. ✅ 並列処理最適化 (fetch高速化) - タイムアウト設定可能
4. ⏳ 設定ファイル対応
5. ⏳ 除外パターン機能
6. ⏳ エラーハンドリング強化

#### Phase 4 次優先:
- fetch処理の並列化によるパフォーマンス向上
- タイムアウト機能の追加
- プログレス表示の改善

## マイルストーン

- **M1 (Phase 1完了)** ✅: 基本的なリポジトリ検出ができる
- **M2 (Phase 2完了)** ✅: Git変更を検出し、コンソールに出力できる
- **M3 (Phase 3完了)** ✅: 実用的なCLIツールとして使用可能
- **M4 (Phase 4完了)** ✅: 高機能でユーザーフレンドリーなツール (並列fetch、タイムアウト設定対応)

## 次のステップ
Phase 5の機能を検討・実装:
1. **低優先**: 設定ファイル対応 (.pendectorrc.toml など)
2. **低優先**: 除外パターン機能 (.gitignoreスタイル)
3. **中優先**: エラーハンドリング強化
4. **新機能**: レポート出力機能 (HTML, PDF)

## 現在の機能一覧
- ✅ 基本的なリポジトリ検出と変更状態表示
- ✅ リモート同期状態検出（pull/push必要性）
- ✅ JSON/テキスト出力フォーマット切り替え
- ✅ 自動fetchによる最新リモート状態取得（並列処理、プログレスバー付き）
- ✅ カスタマイズ可能なfetchタイムアウト設定（--fetch-timeout）
- ✅ 変更のみフィルタ、深度制限、複数パス対応
- ✅ 詳細表示モード、カラー出力